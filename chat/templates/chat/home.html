{% extends 'chat/base.html' %}

{% block title %}Home | Orgachat{% endblock title %}

{% block description %}Have the most organized chat you can ever dream with here{% endblock description %}

{% block content %}

<div class="container">
    {% if rooms.count <= 0 %}
    <p>Find and add your friends <a href="{% url 'users:all_users' %}">Here</a></p>
    <p>Or click on the bottom right button to add a chat group</p>
    <p>Add areas from the left sidebar</p>
    <p>We will make an in-depth explainer video soon, so make sure to subscribe to our <a
            href="https://www.youtube.com/channel/UCLb42dgmeMCA0gYP_1P6EzA">YouTube channel</a></p>
    <small class="form-text text-muted">You are seeing this because you don't have chat rooms</small>
    <br>
    <br>
    <div class="video-container">
        <iframe width="560" height="315" src="https://www.youtube.com/embed/xAJIVX5tXeg" frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen></iframe>
    </div>
    {% endif %}
    {% for room in rooms %}
    <p>{{ room.title }}<span class="badge badge-danger ml-3 p-2"
            style="border-radius: 50%;">{{ room.unread_count }}</span></p>
    <p>{{ room.last_message }}</p>
    <a href="{% url 'chat:room' room.id %}" class="btn btn-success"><i class="far fa-comments"></i> Chat</a>
    <hr>
    {% endfor %}
</div>
<button type="button" class="btn btn-success" onclick="openModal('#addGroup')"
    style="border-radius: 200px; padding: 7px; position: absolute; bottom: 30px; right: 30px; font-size: 130%">
    <i class="fas fa-plus"></i> Add Group
</button>
<button type="button" class="btn btn-warning text-white"
    style="border-radius: 200px; padding: 7px; position: absolute; top: 70px; right: 30px; font-size: 130%"
    id="addToHomescreen">Add
    to Homescreen
</button>
<div class="modal fade" id="addGroup" tabindex="-1" role="dialog" aria-labelledby="addGroupLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addGroupLabel">Add Group</h5>
                <button type="button" class="close" onclick="closeModal('#addGroup')">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form action="{% url 'chat:create_group' %}" method="post">
                    {% csrf_token %}
                    <input type="text" name="name" id="id_name" placeholder="Group Name" required maxlength="50"
                        class="from-control">
                    <button type="submit" class="btn btn-success"><i class="fas fa-plus"></i></button>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    let deferredPrompt;
    const addBtn = document.querySelector('#addToHomescreen');
    addBtn.style.display = 'none';
    window.addEventListener('beforeinstallprompt', (e) => {
        // Prevent Chrome 67 and earlier from automatically showing the prompt
        e.preventDefault();
        // Stash the event so it can be triggered later.
        deferredPrompt = e;
        // Update UI to notify the user they can add to home screen
        addBtn.style.display = 'block';

        addBtn.addEventListener('click', (e) => {
            // hide our user interface that shows our A2HS button
            // addBtn.style.display = 'none';
            // Show the prompt
            deferredPrompt.prompt();
            // Wait for the user to respond to the prompt
            deferredPrompt.userChoice.then((choiceResult) => {
                if (choiceResult.outcome === 'accepted') {
                    console.log('User accepted the A2HS prompt');
                } else {
                    console.log('User dismissed the A2HS prompt');
                }
                deferredPrompt = null;
            });
        });
    });
</script>
{% endblock content %}